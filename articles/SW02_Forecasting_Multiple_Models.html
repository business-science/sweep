<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Forecasting Using Multiple Models • sweep</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Forecasting Using Multiple Models">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-20GDZ5LL77"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-20GDZ5LL77');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sweep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/SW00_Introduction_to_sweep.html">Start</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-api" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">API</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-api">
<li><h6 class="dropdown-header" data-toc-skip>API Functions</h6></li>
    <li><a class="dropdown-item" href="../reference/index.html"><span class="fa fa-home"></span> Function Reference</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Change History</h6></li>
    <li><a class="dropdown-item" href="../news/index.html">News</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/business-science/sweep"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Forecasting Using Multiple Models</h1>
                        <h4 data-toc-skip class="author">Matt
Dancho</h4>
            
            <h4 data-toc-skip class="date">2025-08-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/business-science/sweep/blob/0.2.6/vignettes/SW02_Forecasting_Multiple_Models.Rmd" class="external-link"><code>vignettes/SW02_Forecasting_Multiple_Models.Rmd</code></a></small>
      <div class="d-none name"><code>SW02_Forecasting_Multiple_Models.Rmd</code></div>
    </div>

    
    
<blockquote>
<p>Extending <code>broom</code> to time series forecasting</p>
</blockquote>
<p>One of the most powerful benefits of <code>sweep</code> is that it
helps forecasting at scale within the “tidyverse”. There are two common
situations:</p>
<ol style="list-style-type: decimal">
<li>Applying a model to groups of time series</li>
<li>Applying multiple models to a time series</li>
</ol>
<p>In this vignette we’ll review how <code>sweep</code> can help the
<strong>second situation</strong>: <em>Applying multiple models to a
time series</em>.</p>
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<p>Before we get started, load the following packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://business-science.github.io/tidyquant/" class="external-link">tidyquant</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/timetk" class="external-link">timetk</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://business-science.github.io/sweep/">sweep</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pkg.robjhyndman.com/forecast/" class="external-link">forecast</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="forecasting-gasoline-prices">Forecasting Gasoline Prices<a class="anchor" aria-label="anchor" href="#forecasting-gasoline-prices"></a>
</h2>
<p>To start, let’s get some data from the FRED data base using
<code>tidyquant</code>. We’ll use <code><a href="https://business-science.github.io/tidyquant/reference/tq_get.html" class="external-link">tq_get()</a></code> to retrieve the
Gasoline Prices from 1990 through today (2025-08-28).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gas_prices_monthly_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://business-science.github.io/tidyquant/reference/tq_get.html" class="external-link">tq_get</a></span><span class="op">(</span></span>
<span>    x    <span class="op">=</span> <span class="st">"GASREGCOVM"</span>, </span>
<span>    get  <span class="op">=</span> <span class="st">"economic.data"</span>, </span>
<span>    from <span class="op">=</span> <span class="st">"1990-01-01"</span>, </span>
<span>    to   <span class="op">=</span> <span class="st">"2016-12-31"</span><span class="op">)</span> </span>
<span><span class="va">gas_prices_monthly_raw</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 316 × 3</span></span></span>
<span><span class="co">##    symbol     date       price</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> GASREGCOVM 1990-09-01  1.26</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> GASREGCOVM 1990-10-01  1.34</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> GASREGCOVM 1990-11-01  1.32</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> GASREGCOVM 1990-12-01 <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> GASREGCOVM 1991-01-01 <span style="color: #BB0000;">NA</span>   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> GASREGCOVM 1991-02-01  1.09</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> GASREGCOVM 1991-03-01  1.04</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> GASREGCOVM 1991-04-01  1.08</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> GASREGCOVM 1991-05-01  1.13</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> GASREGCOVM 1991-06-01  1.13</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 306 more rows</span></span></span></code></pre>
<p>Upon a brief inspection, the data contains 2 <code>NA</code> values
that will need to be dealt with.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">gas_prices_monthly_raw</span><span class="op">$</span><span class="va">price</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span><span class="co">##   0.900   1.138   1.615   1.974   2.697   4.002       2</span></span></code></pre>
<p>We can use the <code><a href="https://tidyr.tidyverse.org/reference/fill.html" class="external-link">fill()</a></code> from the <code>tidyr</code>
package to help deal with these data. We first fill down and then fill
up to use the previous and then post days prices to fill in the missing
data.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gas_prices_monthly</span> <span class="op">&lt;-</span> <span class="va">gas_prices_monthly_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/fill.html" class="external-link">fill</a></span><span class="op">(</span><span class="va">price</span>, .direction <span class="op">=</span> <span class="st">"down"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/fill.html" class="external-link">fill</a></span><span class="op">(</span><span class="va">price</span>, .direction <span class="op">=</span> <span class="st">"up"</span><span class="op">)</span></span></code></pre></div>
<p>We can now visualize the data.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gas_prices_monthly</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">price</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://business-science.github.io/tidyquant/reference/palette_tq.html" class="external-link">palette_light</a></span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Gasoline Prices, Monthly"</span>, x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"USD"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/dollar_format.html" class="external-link">dollar</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://business-science.github.io/tidyquant/reference/theme_tq.html" class="external-link">theme_tq</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="SW02_Forecasting_Multiple_Models_files/figure-html/unnamed-chunk-6-1.png" width="95%" style="display: block; margin: auto;"></p>
<p>Monthly periodicity might be a bit granular for model fitting. We can
easily switch periodicity to quarterly using <code><a href="https://business-science.github.io/tidyquant/reference/tq_mutate.html" class="external-link">tq_transmute()</a></code>
from the <code>tidyquant</code> package along with the periodicity
aggregation function <code>to.period</code> from the <code>xts</code>
package. We’ll convert the date to <code>yearqtr</code> class which is
regularized.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gas_prices_quarterly</span> <span class="op">&lt;-</span> <span class="va">gas_prices_monthly</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://business-science.github.io/tidyquant/reference/tq_mutate.html" class="external-link">tq_transmute</a></span><span class="op">(</span>mutate_fun <span class="op">=</span> <span class="va">to.period</span>, period <span class="op">=</span> <span class="st">"quarters"</span><span class="op">)</span> </span>
<span><span class="va">gas_prices_quarterly</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 106 × 2</span></span></span>
<span><span class="co">##    date       price</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 1990-09-01  1.26</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 1990-12-01  1.32</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 1991-03-01  1.04</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 1991-06-01  1.13</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 1991-09-01  1.11</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 1991-12-01  1.08</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 1992-03-01  1.01</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 1992-06-01  1.14</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 1992-09-01  1.12</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 1992-12-01  1.08</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 96 more rows</span></span></span></code></pre>
<p>Another quick visualization to show the reduction in granularity.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gas_prices_quarterly</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">price</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://business-science.github.io/tidyquant/reference/palette_tq.html" class="external-link">palette_light</a></span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Gasoline Prices, Quarterly"</span>, x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"USD"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/dollar_format.html" class="external-link">label_dollar</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"5 years"</span>, date_labels <span class="op">=</span> <span class="st">"%Y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://business-science.github.io/tidyquant/reference/theme_tq.html" class="external-link">theme_tq</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="SW02_Forecasting_Multiple_Models_files/figure-html/unnamed-chunk-8-1.png" width="95%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="performing-forecasts-using-multiple-models">Performing Forecasts Using Multiple Models<a class="anchor" aria-label="anchor" href="#performing-forecasts-using-multiple-models"></a>
</h2>
<p>In this section we will use three models to forecast gasoline
prices:</p>
<ol style="list-style-type: decimal">
<li>ARIMA</li>
<li>ETS</li>
<li>BATS</li>
</ol>
<div class="section level3">
<h3 id="multiple-models-concept">Multiple Models Concept<a class="anchor" aria-label="anchor" href="#multiple-models-concept"></a>
</h3>
<p>Before we jump into modeling, let’s take a look at the multiple model
process from <a href="https://r4ds.had.co.nz/many-models.html#from-a-named-list" class="external-link">R for
Data Science, Chapter 25 Many Models</a>. We first create a data frame
from a named list. The example below has two columns: “f” the functions
as text, and “params” a nested list of parameters we will pass to the
respective function in column “f”.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  f <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"runif"</span>, <span class="st">"rpois"</span>, <span class="st">"rnorm"</span><span class="op">)</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span>, lambda <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, mean <span class="op">=</span> <span class="op">-</span><span class="fl">3</span>, sd <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">df</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">##   f     params          </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> runif <span style="color: #949494;">&lt;named list [1]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> rpois <span style="color: #949494;">&lt;named list [2]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> rnorm <span style="color: #949494;">&lt;named list [3]&gt;</span></span></span></code></pre>
<p>We can also view the contents of the <code>df$params</code> column to
understand the underlying structure. Notice that there are three primary
levels and then secondary levels containing the name-value pairs of
parameters. This format is important.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span><span class="op">$</span><span class="va">params</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">## [[1]]$n</span></span>
<span><span class="co">## [1] 10</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">## [[2]]$n</span></span>
<span><span class="co">## [1] 5</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]$lambda</span></span>
<span><span class="co">## [1] 10</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">## [[3]]$n</span></span>
<span><span class="co">## [1] 10</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]$mean</span></span>
<span><span class="co">## [1] -3</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]$sd</span></span>
<span><span class="co">## [1] 10</span></span></code></pre>
<p>Next we apply the functions to the parameters using a special
function, <code><a href="https://purrr.tidyverse.org/reference/invoke.html" class="external-link">invoke_map()</a></code>. The parameter lists in the “params”
column are passed to the function in the “f” column. The output is in a
nested list-column named “out”.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># FIXME invoke_map is deprecated</span></span>
<span><span class="va">df_out</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>out <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/invoke.html" class="external-link">invoke_map</a></span><span class="op">(</span><span class="va">f</span>, <span class="va">params</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: There was 1 warning in `mutate()`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> In argument: `out = invoke_map(f, params)`.</span></span>
<span><span class="co">## Caused by warning:</span></span>
<span><span class="co">## <span style="color: #BBBB00;">!</span> `invoke_map()` was deprecated in purrr 1.0.0.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Please use map() + exec() instead.</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_out</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">##   f     params           out       </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> runif <span style="color: #949494;">&lt;named list [1]&gt;</span> <span style="color: #949494;">&lt;dbl [10]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> rpois <span style="color: #949494;">&lt;named list [2]&gt;</span> <span style="color: #949494;">&lt;int [5]&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> rnorm <span style="color: #949494;">&lt;named list [3]&gt;</span> <span style="color: #949494;">&lt;dbl [10]&gt;</span></span></span></code></pre>
<p>And, here’s the contents of “out”, which is the result of mapping a
list of functions to a list of parameters. Pretty powerful!</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_out</span><span class="op">$</span><span class="va">out</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">##  [1] 0.080750138 0.834333037 0.600760886 0.157208442 0.007399441 0.466393497</span></span>
<span><span class="co">##  [7] 0.497777389 0.289767245 0.732881987 0.772521511</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">## [1] 13  4  7  9  8</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">##  [1]   3.289820  17.650249 -19.309894   2.124269 -21.630115  -8.220125</span></span>
<span><span class="co">##  [7]  -3.526019   2.429963 -12.140748   1.681544</span></span></code></pre>
<p>Take a minute to understand the conceptual process of the
<code>invoke_map</code> function and specifically the parameter setup.
Once you are comfortable, we can move on to model implementation.</p>
</div>
<div class="section level3">
<h3 id="multiple-model-implementation">Multiple Model Implementation<a class="anchor" aria-label="anchor" href="#multiple-model-implementation"></a>
</h3>
<p>We’ll need to take the following steps to in an actual forecast model
implementation:</p>
<ol style="list-style-type: decimal">
<li>Coerce the data to time series</li>
<li>Build a model list using nested lists</li>
<li>Create the the model data frame</li>
<li>Invoke a function map</li>
</ol>
<p>This is easier than it sounds. Let’s start by coercing the univariate
time series with <code><a href="https://business-science.github.io/timetk/reference/tk_ts.html" class="external-link">tk_ts()</a></code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gas_prices_quarterly_ts</span> <span class="op">&lt;-</span> <span class="va">gas_prices_quarterly</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://business-science.github.io/timetk/reference/tk_ts.html" class="external-link">tk_ts</a></span><span class="op">(</span>select <span class="op">=</span> <span class="op">-</span><span class="va">date</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">3</span><span class="op">)</span>, freq <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">gas_prices_quarterly_ts</span></span></code></pre></div>
<pre><code><span><span class="co">##       Qtr1  Qtr2  Qtr3  Qtr4</span></span>
<span><span class="co">## 1990             1.258 1.324</span></span>
<span><span class="co">## 1991 1.040 1.128 1.109 1.076</span></span>
<span><span class="co">## 1992 1.013 1.145 1.122 1.078</span></span>
<span><span class="co">## 1993 1.052 1.097 1.050 1.014</span></span>
<span><span class="co">## 1994 1.008 1.078 1.144 1.060</span></span>
<span><span class="co">## 1995 1.059 1.186 1.108 1.066</span></span>
<span><span class="co">## 1996 1.129 1.243 1.200 1.233</span></span>
<span><span class="co">## 1997 1.197 1.189 1.216 1.119</span></span>
<span><span class="co">## 1998 1.014 1.048 0.994 0.923</span></span>
<span><span class="co">## 1999 0.961 1.095 1.239 1.261</span></span>
<span><span class="co">## 2000 1.498 1.612 1.525 1.418</span></span>
<span><span class="co">## 2001 1.384 1.548 1.506 1.072</span></span>
<span><span class="co">## 2002 1.221 1.341 1.363 1.348</span></span>
<span><span class="co">## 2003 1.636 1.452 1.616 1.448</span></span>
<span><span class="co">## 2004 1.689 1.910 1.841 1.800</span></span>
<span><span class="co">## 2005 2.063 2.123 2.862 2.174</span></span>
<span><span class="co">## 2006 2.413 2.808 2.501 2.284</span></span>
<span><span class="co">## 2007 2.503 3.024 2.817 2.984</span></span>
<span><span class="co">## 2008 3.215 3.989 3.709 1.669</span></span>
<span><span class="co">## 2009 1.937 2.597 2.480 2.568</span></span>
<span><span class="co">## 2010 2.742 2.684 2.678 2.951</span></span>
<span><span class="co">## 2011 3.509 3.628 3.573 3.220</span></span>
<span><span class="co">## 2012 3.774 3.465 3.801 3.256</span></span>
<span><span class="co">## 2013 3.648 3.576 3.474 3.209</span></span>
<span><span class="co">## 2014 3.474 3.626 3.354 2.488</span></span>
<span><span class="co">## 2015 2.352 2.700 2.275 1.946</span></span>
<span><span class="co">## 2016 1.895 2.303 2.161 2.192</span></span></code></pre>
<p>Next, create a nested list using the function names as the
first-level keys (this is important as you’ll see in the next step).
Pass the model parameters as name-value pairs in the second level.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    auto.arima <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        y <span class="op">=</span> <span class="va">gas_prices_quarterly_ts</span></span>
<span>        <span class="op">)</span>,</span>
<span>    ets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        y <span class="op">=</span> <span class="va">gas_prices_quarterly_ts</span>,</span>
<span>        damped <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span>,</span>
<span>    bats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        y <span class="op">=</span> <span class="va">gas_prices_quarterly_ts</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now, convert to a data frame using the function,
<code>enframe()</code> that turns lists into tibbles. Set the arguments
<code>name = "f"</code> and <code>value = "params"</code>. In doing so
we get a bonus: the model names are the now conveniently located in
column “f”.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models_tbl</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/enframe.html" class="external-link">enframe</a></span><span class="op">(</span><span class="va">models_list</span>, name <span class="op">=</span> <span class="st">"f"</span>, value <span class="op">=</span> <span class="st">"params"</span><span class="op">)</span></span>
<span><span class="va">models_tbl</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">##   f          params          </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> auto.arima <span style="color: #949494;">&lt;named list [1]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> ets        <span style="color: #949494;">&lt;named list [2]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> bats       <span style="color: #949494;">&lt;named list [1]&gt;</span></span></span></code></pre>
<p>We are ready to invoke the map. Combine <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code> with
<code><a href="https://purrr.tidyverse.org/reference/invoke.html" class="external-link">invoke_map()</a></code> as follows. Bada bing, bada boom, we now have
models fitted using the parameters we defined previously.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models_tbl_fit</span> <span class="op">&lt;-</span> <span class="va">models_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/invoke.html" class="external-link">invoke_map</a></span><span class="op">(</span><span class="va">f</span>, <span class="va">params</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">models_tbl_fit</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">##   f          params           fit       </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> auto.arima <span style="color: #949494;">&lt;named list [1]&gt;</span> <span style="color: #949494;">&lt;fr_ARIMA&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> ets        <span style="color: #949494;">&lt;named list [2]&gt;</span> <span style="color: #949494;">&lt;ets&gt;</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> bats       <span style="color: #949494;">&lt;named list [1]&gt;</span> <span style="color: #949494;">&lt;bats&gt;</span></span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="inspecting-the-model-fit">Inspecting the Model Fit<a class="anchor" aria-label="anchor" href="#inspecting-the-model-fit"></a>
</h2>
<p>It’s a good point to review and understand the model output. We can
review the model parameters, accuracy measurements, and the residuals
using <code><a href="../reference/sw_tidy.html">sw_tidy()</a></code>, <code><a href="../reference/sw_glance.html">sw_glance()</a></code>, and
<code><a href="../reference/sw_augment.html">sw_augment()</a></code>.</p>
<div class="section level3">
<h3 id="sw_tidy">sw_tidy<a class="anchor" aria-label="anchor" href="#sw_tidy"></a>
</h3>
<p>The tidying function returns the model parameters and estimates. We
use the combination of <code>mutate</code> and <code>map</code> to
iteratively apply the <code><a href="../reference/sw_tidy.html">sw_tidy()</a></code> function as a new column
named “tidy”. Then we unnest and spread to review the terms by model
function.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models_tbl_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>tidy <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">sw_tidy</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">tidy</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/spread.html" class="external-link">spread</a></span><span class="op">(</span>key <span class="op">=</span> <span class="va">f</span>, value <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 20 × 6</span></span></span>
<span><span class="co">##    params           fit        term              auto.arima       bats       ets</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> <span style="color: #949494;">&lt;named list [1]&gt;</span> <span style="color: #949494;">&lt;fr_ARIMA&gt;</span> ar1                    0.834 <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> <span style="color: #949494;">&lt;named list [1]&gt;</span> <span style="color: #949494;">&lt;fr_ARIMA&gt;</span> ma1                   -<span style="color: #BB0000;">0.964</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> <span style="color: #949494;">&lt;named list [1]&gt;</span> <span style="color: #949494;">&lt;fr_ARIMA&gt;</span> sar1                   0.939 <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> <span style="color: #949494;">&lt;named list [1]&gt;</span> <span style="color: #949494;">&lt;fr_ARIMA&gt;</span> sma1                  -<span style="color: #BB0000;">0.776</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> <span style="color: #949494;">&lt;named list [1]&gt;</span> <span style="color: #949494;">&lt;bats&gt;</span>     alpha                 <span style="color: #BB0000;">NA</span>      0.588     <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> <span style="color: #949494;">&lt;named list [1]&gt;</span> <span style="color: #949494;">&lt;bats&gt;</span>     ar.coefficients       <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> <span style="color: #949494;">&lt;named list [1]&gt;</span> <span style="color: #949494;">&lt;bats&gt;</span>     beta                  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> <span style="color: #949494;">&lt;named list [1]&gt;</span> <span style="color: #949494;">&lt;bats&gt;</span>     damping.parameter     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> <span style="color: #949494;">&lt;named list [1]&gt;</span> <span style="color: #949494;">&lt;bats&gt;</span>     gamma.values          <span style="color: #BB0000;">NA</span>     -<span style="color: #BB0000;">0.026</span><span style="color: #BB0000; text-decoration: underline;">2</span>    <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> <span style="color: #949494;">&lt;named list [1]&gt;</span> <span style="color: #949494;">&lt;bats&gt;</span>     lambda                <span style="color: #BB0000;">NA</span>      0.000<span style="text-decoration: underline;">060</span>5 <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">11</span> <span style="color: #949494;">&lt;named list [1]&gt;</span> <span style="color: #949494;">&lt;bats&gt;</span>     ma.coefficients       <span style="color: #BB0000;">NA</span>      0.256     <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">12</span> <span style="color: #949494;">&lt;named list [2]&gt;</span> <span style="color: #949494;">&lt;ets&gt;</span>      alpha                 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>          0.831   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">13</span> <span style="color: #949494;">&lt;named list [2]&gt;</span> <span style="color: #949494;">&lt;ets&gt;</span>      b                     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>         -<span style="color: #BB0000;">0.052</span><span style="color: #BB0000; text-decoration: underline;">4</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">14</span> <span style="color: #949494;">&lt;named list [2]&gt;</span> <span style="color: #949494;">&lt;ets&gt;</span>      beta                  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>          0.000<span style="text-decoration: underline;">100</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">15</span> <span style="color: #949494;">&lt;named list [2]&gt;</span> <span style="color: #949494;">&lt;ets&gt;</span>      gamma                 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>          0.052<span style="text-decoration: underline;">1</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">16</span> <span style="color: #949494;">&lt;named list [2]&gt;</span> <span style="color: #949494;">&lt;ets&gt;</span>      l                     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>          1.29    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">17</span> <span style="color: #949494;">&lt;named list [2]&gt;</span> <span style="color: #949494;">&lt;ets&gt;</span>      phi                   <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>          0.837   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">18</span> <span style="color: #949494;">&lt;named list [2]&gt;</span> <span style="color: #949494;">&lt;ets&gt;</span>      s0                    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>          0.046<span style="text-decoration: underline;">9</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">19</span> <span style="color: #949494;">&lt;named list [2]&gt;</span> <span style="color: #949494;">&lt;ets&gt;</span>      s1                    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>         -<span style="color: #BB0000;">0.020</span><span style="color: #BB0000; text-decoration: underline;">9</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">20</span> <span style="color: #949494;">&lt;named list [2]&gt;</span> <span style="color: #949494;">&lt;ets&gt;</span>      s2                    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>         -<span style="color: #BB0000;">0.040</span><span style="color: #BB0000; text-decoration: underline;">7</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="sw_glance">sw_glance<a class="anchor" aria-label="anchor" href="#sw_glance"></a>
</h3>
<p>Glance is one of the most powerful tools because it yields the model
accuracies enabling direct comparisons between the fit of each model. We
use the same process for used for tidy, except theres no need to spread
to perform the comparison. We can see that the ARIMA model has the
lowest AIC by far.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models_tbl_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>glance <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">sw_glance</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">glance</span>, .drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: The `.drop` argument of `unnest()` is deprecated as of tidyr 1.0.0.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> All list-columns are now preserved.</span></span>
<span><span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">## <span style="color: #555555;">generated.</span></span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 15</span></span></span>
<span><span class="co">##   f     params       fit        model.desc sigma logLik   AIC   BIC     ME  RMSE</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> auto… <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;fr_ARIMA&gt;</span> ARIMA(1,1… 0.298  -<span style="color: #BB0000;">20.6</span>  51.2  64.4 0.018<span style="text-decoration: underline;">0</span> 0.291</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> ets   <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;ets&gt;</span>      ETS(M,Ad,… 0.118  -<span style="color: #BB0000;">76.6</span> 173.  200.  0.014<span style="text-decoration: underline;">9</span> 0.292</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> bats  <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;bats&gt;</span>     BATS(0, {… 0.116  159.  179.  184.  0.019<span style="text-decoration: underline;">3</span> 0.259</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 5 more variables: MAE &lt;dbl&gt;, MPE &lt;dbl&gt;, MAPE &lt;dbl&gt;, MASE &lt;dbl&gt;, ACF1 &lt;dbl&gt;</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="sw_augment">sw_augment<a class="anchor" aria-label="anchor" href="#sw_augment"></a>
</h3>
<p>We can augment the models to get the residuals following the same
procedure. We can pipe (<code>%&gt;%</code>) the results right into
<code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot()</a></code> for plotting. Notice the ARIMA model has the
largest residuals especially as the model index increases whereas the
bats model has relatively low residuals.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models_tbl_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>augment <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">sw_augment</span>, rename_index <span class="op">=</span> <span class="st">"date"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">augment</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">.resid</span>, group <span class="op">=</span> <span class="va">f</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://business-science.github.io/tidyquant/reference/palette_tq.html" class="external-link">palette_light</a></span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://business-science.github.io/tidyquant/reference/palette_tq.html" class="external-link">palette_light</a></span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">f</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Residuals Plot"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://business-science.github.io/tidyquant/reference/theme_tq.html" class="external-link">theme_tq</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre>
<p><img src="SW02_Forecasting_Multiple_Models_files/figure-html/unnamed-chunk-19-1.png" width="95%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="forecasting-the-model">Forecasting the model<a class="anchor" aria-label="anchor" href="#forecasting-the-model"></a>
</h2>
<p>Creating the forecast for the models is accomplished by mapping the
<code>forecast</code> function. The next six quarters are forecasted
withe the argument <code>h = 6</code>.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models_tbl_fcast</span> <span class="op">&lt;-</span> <span class="va">models_tbl_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>fcast <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">forecast</span>, h <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">models_tbl_fcast</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 4</span></span></span>
<span><span class="co">##   f          params           fit        fcast     </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> auto.arima <span style="color: #949494;">&lt;named list [1]&gt;</span> <span style="color: #949494;">&lt;fr_ARIMA&gt;</span> <span style="color: #949494;">&lt;forecast&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> ets        <span style="color: #949494;">&lt;named list [2]&gt;</span> <span style="color: #949494;">&lt;ets&gt;</span>      <span style="color: #949494;">&lt;forecast&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> bats       <span style="color: #949494;">&lt;named list [1]&gt;</span> <span style="color: #949494;">&lt;bats&gt;</span>     <span style="color: #949494;">&lt;forecast&gt;</span></span></span></code></pre>
</div>
<div class="section level2">
<h2 id="tidying-the-forecast">Tidying the forecast<a class="anchor" aria-label="anchor" href="#tidying-the-forecast"></a>
</h2>
<p>Next, we map <code>sw_sweep</code>, which coerces the forecast into
the “tidy” tibble format. We set <code>fitted = FALSE</code> to remove
the model fitted values from the output. We set
<code>timetk_idx = TRUE</code> to use dates instead of numeric values
for the index.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models_tbl_fcast_tidy</span> <span class="op">&lt;-</span> <span class="va">models_tbl_fcast</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sweep <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">fcast</span>, <span class="va">sw_sweep</span>, fitted <span class="op">=</span> <span class="cn">FALSE</span>, timetk_idx <span class="op">=</span> <span class="cn">TRUE</span>, rename_index <span class="op">=</span> <span class="st">"date"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: There were 3 warnings in `mutate()`.</span></span>
<span><span class="co">## The first warning was:</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> In argument: `sweep = map(fcast, sw_sweep, fitted = FALSE, timetk_idx = TRUE,</span></span>
<span><span class="co">##   rename_index = "date")`.</span></span>
<span><span class="co">## Caused by warning in `.check_tzones()`:</span></span>
<span><span class="co">## <span style="color: #BBBB00;">!</span> 'tzone' attributes are inconsistent</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Run `dplyr::last_dplyr_warnings()` to see the 2 remaining warnings.</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models_tbl_fcast_tidy</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 5</span></span></span>
<span><span class="co">##   f          params           fit        fcast      sweep             </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> auto.arima <span style="color: #949494;">&lt;named list [1]&gt;</span> <span style="color: #949494;">&lt;fr_ARIMA&gt;</span> <span style="color: #949494;">&lt;forecast&gt;</span> <span style="color: #949494;">&lt;tibble [112 × 7]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> ets        <span style="color: #949494;">&lt;named list [2]&gt;</span> <span style="color: #949494;">&lt;ets&gt;</span>      <span style="color: #949494;">&lt;forecast&gt;</span> <span style="color: #949494;">&lt;tibble [112 × 7]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> bats       <span style="color: #949494;">&lt;named list [1]&gt;</span> <span style="color: #949494;">&lt;bats&gt;</span>     <span style="color: #949494;">&lt;forecast&gt;</span> <span style="color: #949494;">&lt;tibble [112 × 7]&gt;</span></span></span></code></pre>
<p>We can unnest the “sweep” column to get the results of all three
models.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models_tbl_fcast_tidy</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">sweep</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 336 × 11</span></span></span>
<span><span class="co">##    f       params       fit        fcast      date       key   price lo.80 lo.95</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> auto.a… <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;fr_ARIMA&gt;</span> <span style="color: #949494;">&lt;forecast&gt;</span> 1990-09-01 actu…  1.26    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> auto.a… <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;fr_ARIMA&gt;</span> <span style="color: #949494;">&lt;forecast&gt;</span> 1990-12-01 actu…  1.32    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> auto.a… <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;fr_ARIMA&gt;</span> <span style="color: #949494;">&lt;forecast&gt;</span> 1991-03-01 actu…  1.04    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> auto.a… <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;fr_ARIMA&gt;</span> <span style="color: #949494;">&lt;forecast&gt;</span> 1991-06-01 actu…  1.13    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> auto.a… <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;fr_ARIMA&gt;</span> <span style="color: #949494;">&lt;forecast&gt;</span> 1991-09-01 actu…  1.11    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> auto.a… <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;fr_ARIMA&gt;</span> <span style="color: #949494;">&lt;forecast&gt;</span> 1991-12-01 actu…  1.08    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> auto.a… <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;fr_ARIMA&gt;</span> <span style="color: #949494;">&lt;forecast&gt;</span> 1992-03-01 actu…  1.01    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> auto.a… <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;fr_ARIMA&gt;</span> <span style="color: #949494;">&lt;forecast&gt;</span> 1992-06-01 actu…  1.14    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> auto.a… <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;fr_ARIMA&gt;</span> <span style="color: #949494;">&lt;forecast&gt;</span> 1992-09-01 actu…  1.12    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> auto.a… <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;fr_ARIMA&gt;</span> <span style="color: #949494;">&lt;forecast&gt;</span> 1992-12-01 actu…  1.08    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 326 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 2 more variables: hi.80 &lt;dbl&gt;, hi.95 &lt;dbl&gt;</span></span></span></code></pre>
<p>Finally, we can plot the forecasts by unnesting the “sweep” column
and piping to <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot()</a></code>.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models_tbl_fcast_tidy</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">sweep</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">price</span>, color <span class="op">=</span> <span class="va">key</span>, group <span class="op">=</span> <span class="va">f</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lo.95</span>, ymax <span class="op">=</span> <span class="va">hi.95</span><span class="op">)</span>, </span>
<span>                fill <span class="op">=</span> <span class="st">"#D5DBFF"</span>, color <span class="op">=</span> <span class="cn">NA</span>, linewidth <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lo.80</span>, ymax <span class="op">=</span> <span class="va">hi.80</span>, fill <span class="op">=</span> <span class="va">key</span><span class="op">)</span>, </span>
<span>                fill <span class="op">=</span> <span class="st">"#596DD5"</span>, color <span class="op">=</span> <span class="cn">NA</span>, linewidth <span class="op">=</span> <span class="fl">0</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">f</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Gasoline Price Forecasts"</span>,</span>
<span>         subtitle <span class="op">=</span> <span class="st">"Forecasting multiple models with sweep: ARIMA, BATS, ETS"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Price"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/dollar_format.html" class="external-link">label_dollar</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"5 years"</span>, date_labels <span class="op">=</span> <span class="st">"%Y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://business-science.github.io/tidyquant/reference/theme_tq.html" class="external-link">theme_tq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://business-science.github.io/tidyquant/reference/scale_manual.html" class="external-link">scale_color_tq</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="SW02_Forecasting_Multiple_Models_files/figure-html/unnamed-chunk-23-1.png" width="95%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="recap">Recap<a class="anchor" aria-label="anchor" href="#recap"></a>
</h2>
<p>The <code>sweep</code> package can aid analysis of multiple forecast
models. In the next vignette we will review time series object coercion
with <code>sweep</code>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matt Dancho, Davis Vaughan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
